package org.getopentest.appium;

import io.appium.java_client.MobileDriver;
import io.appium.java_client.MobileElement;
import io.appium.java_client.TouchAction;
import org.openqa.selenium.By;
import org.getopentest.annotations.TestActionArgument;
import org.getopentest.annotations.TestActionClass;
import org.getopentest.annotations.TestActionOutput;
import org.getopentest.annotations.Type;

@TestActionClass(
        description = "An action that performs a long press gesture"
        + " at the center of the specified UI element, for the given duration.")
@TestActionArgument(name = "locator", type = Type.STRING, optional = false,
        description = "The locator of the UI element.")
@TestActionArgument(name = "durationMs", type = Type.INTEGER, optional = true,
        description = "The duration of the long press, in milliseconds. If the "
        + "durationMs argument is not specified, the long press will be held"
        + "until the contextmenu event has fired.")

/**
 * This is action can be used to perform a long press gesture on a UI element
 * for a specified duration.
 */
public class LongPress extends AppiumTestAction {

    @Override
    public void run() {
        super.run();

        By locator = this.readLocatorArgument("locator");
        Integer durationMs = this.readIntArgument("durationMs", null);

        MobileElement element = getElement(locator);
        TouchAction action = new TouchAction((MobileDriver) driver);
        
        if (durationMs == null) {
            action.longPress(element);
        } else {
            action.longPress(element, durationMs);
        }
        
        action.release().perform();
    }
}
