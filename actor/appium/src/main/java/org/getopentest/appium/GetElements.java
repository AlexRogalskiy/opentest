package org.getopentest.appium;

import io.appium.java_client.MobileElement;
import java.util.List;
import java.util.stream.Collectors;
import org.getopentest.annotations.TestActionArgument;
import org.getopentest.annotations.TestActionClass;
import org.getopentest.annotations.Type;
import org.getopentest.appium.core.AppiumTestAction;
import org.getopentest.appium.core.ElementWrapper;
import org.openqa.selenium.By;

@TestActionClass(description = "Collects and returns a list of UI elements.")
@TestActionArgument(
        name = "locator", type = Type.OBJECT, optional = false,
        description = "Locator object that identifies the elements to return.")

public class GetElements extends AppiumTestAction {

    @Override
    public void run() {
        By locator = this.readLocatorArgument("locator");

        List<MobileElement> elements = this.getElements(locator);
        List<ElementWrapper> wrappedElements = elements
                .stream()
                .map(e -> new ElementWrapper(e))
                .collect(Collectors.toList());
        this.writeOutput("elements", this.getActor().toJsArray(wrappedElements));
    }
}
