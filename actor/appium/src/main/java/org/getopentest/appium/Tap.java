package org.getopentest.appium;

import io.appium.java_client.MobileElement;
import io.appium.java_client.TouchAction;
import io.appium.java_client.touch.TapOptions;
import io.appium.java_client.touch.offset.ElementOption;
import io.appium.java_client.touch.offset.PointOption;
import org.getopentest.appium.core.SwipingAction;
import org.openqa.selenium.By;

public class Tap extends SwipingAction {

    @Override
    public void run() {
        super.run();

        By locator = this.readLocatorArgument("locator", null);
        Integer xOffset = this.readIntArgument("xOffset", 0);
        Integer yOffset = this.readIntArgument("yOffset", 0);
        Integer x = this.readIntArgument("x", null);
        Integer y = this.readIntArgument("y", null);

        if (locator != null) {
            this.swipeAndCheckElementVisible(locator, this.getSwipeOptions());
            
            MobileElement element = this.getElement(locator);
            (new TouchAction(driver))
                    .tap(TapOptions.tapOptions()
                            .withElement(ElementOption.element(element, xOffset, yOffset)))
                    .perform();
        } else if (x != null && y != null) {
            (new TouchAction(driver))
                    .tap(TapOptions.tapOptions()
                            .withPosition(PointOption.point(x, y)))
                    .perform();
        } else {
            throw new RuntimeException(
                    "You must either provide the locator argument of the element to tap, "
                    + "or the x and y arguments to indicate the exact coordinates to tap at.");
        }

    }
}
