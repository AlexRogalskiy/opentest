/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package dtest.mobileactions;

import org.openqa.selenium.By;
import org.openqa.selenium.Dimension;

/**
 *
 * @author mc53437
 */
public class SwipeAndTap extends MobileTestAction {

    @Override
    public void run() throws Exception {
        By locator = getLocatorArgument("locator");
        boolean isElementExist = swipeAndFindElement(locator);

        if (isElementExist) {
            findElement(locator, 180).click();
        } else {
            String message = String.format("Could not find element identified by: %s", locator.toString());
            throw new Exception(message);
        }
    }

    private boolean swipeAndFindElement(By element) throws InterruptedException {
        boolean foundElement = false;

        for (int i = 0; i < 20; i++) {
            boolean exist = waitForElement(element, 1);
            if (exist) {
                foundElement = true;
                break;
            } else {
                swipeVertical("Down");
            }
        }
        return foundElement;
    }

    private void swipeVertical(String swipeType) throws InterruptedException {

        //Get the size of screen.
        Dimension size;
        size = driver.manage().window().getSize();
        System.out.println(size);

        //Find swipe start and end point from screen's with and height.
        //Find starty point which is at bottom side of screen.
        int starty = (int) (size.height * 0.80);

        //Find endy point which is at top side of screen.
        int endy = (int) (size.height * 0.20);

        //Find horizontal point where you wants to swipe. It is in middle of screen width.
        int startx = size.width / 2;

        //Swipe from Bottom to Top.
        if (swipeType.equalsIgnoreCase("Down")) {
            driver.swipe(startx, starty, startx, endy, 3000);
            Thread.sleep(1000);
        }

        //Swipe from Top to Bottom.
        if (swipeType.equalsIgnoreCase("Up")) {
            driver.swipe(startx, endy, startx, starty, 3000);
            Thread.sleep(1000);
        }
    }
}
