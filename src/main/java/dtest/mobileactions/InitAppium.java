package dtest.mobileactions;

import dtest.base.TestAction;
import org.openqa.selenium.SessionNotCreatedException;
import org.openqa.selenium.remote.SessionNotFoundException;

public class InitAppium extends TestAction {

    @Override
    public void run() {
        String platform = readStringArgument("platform");
        String url = readStringArgument("url");
        Boolean resetDriver = readBooleanArgument("resetDriver", true);

        boolean initialized = false;
        int retriesLeft = 3;

        while (!initialized && retriesLeft > 0) {
            --retriesLeft;

            try {
                Appium.initialize(platform, url, resetDriver);
                initialized = true;
            } catch (SessionNotFoundException | SessionNotCreatedException ex) {
                if (retriesLeft > 0) {
                    log.warning(String.format("Caught a %s exception while initializing Appium. Retries left: %s",
                            ex.getClass().getName(),
                            String.valueOf(retriesLeft)));
                } else {
                    throw ex;
                }
            }
        }
    }
}
