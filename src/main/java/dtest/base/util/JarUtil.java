/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package dtest.base.util;

import java.io.File;
import java.io.IOException;
import java.net.URL;
import java.security.CodeSource;
import java.util.jar.Attributes;
import java.util.jar.JarFile;

/**
 *
 * @author mc28256
 */
public class JarUtil {

    /**
     * Returns the JarFile instance corresponding to the JAR containing the
     * specified class.
     */
    public static JarFile getJarFile(Class klass) {
        try {
            CodeSource src = klass.getProtectionDomain().getCodeSource();
            if (src != null) {
                URL jarUrl = src.getLocation();
                return new JarFile(new File(jarUrl.getPath()));
            } else {
                return null;
            }
        } catch (IOException ex1) {
            return null;
        }
    }

    /**
     * Returns the Implementation-Version manifest attribute for the JAR
     * containing the specified class.
     */
    public static String getManifestAttribute(Class klass, String attributeName) {
        Attributes manifestInfo = getManifestAttributes(klass);
        String version = manifestInfo.getValue(attributeName);
        if (version != null) {
            return version;
        } else {
            return "N/A";
        }
    }
    
    /**
     * Returns the Implementation-Version manifest attribute for the
     * specified JAR.
     */
    public static String getManifestAttribute(JarFile jar, String attributeName) {
        Attributes manifestInfo = getManifestAttributes(jar);
        String version = manifestInfo.getValue(attributeName);
        if (version != null) {
            return version;
        } else {
            return "N/A";
        }
    }

    public static Attributes getManifestAttributes(Class klass) {
        JarFile jar = getJarFile(klass);
        return getManifestAttributes(jar);
    }

    public static Attributes getManifestAttributes(JarFile jar) {
        try {
            return jar.getManifest().getMainAttributes();
        } catch (IOException ex1) {
            return new Attributes();
        }
    }
}
