package org.getopentest.actions.files;

import org.getopentest.base.TestAction;
import java.io.FileInputStream;
import java.nio.charset.Charset;
import org.apache.commons.io.IOUtils;

public class ReadTextFile extends TestAction {

    @Override
    public void run() {
        super.run();

        String filePath = readStringArgument("file");
        
        // Valid encodings are the ones supported by java.nio.charset.Charset:
        // "US-ASCII", "ISO-8859-1", "UTF-8", "UTF-16BE", "UTF-16LE", "UTF-16"
        String encoding = readStringArgument("encoding", "UTF-8");

        try {
            FileInputStream inputStream = new FileInputStream(filePath);

            String text = IOUtils.toString(inputStream, Charset.forName(encoding));
            inputStream.close();
            
            this.writeOutput("text", text);
        } catch (Exception ex) {
            throw new RuntimeException(String.format(
                    "Failed to read file %s using the %s encoding",
                    filePath,
                    encoding), ex);
        }
    }
}
