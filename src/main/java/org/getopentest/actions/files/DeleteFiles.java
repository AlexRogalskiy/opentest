package org.getopentest.actions.files;

import org.getopentest.base.TestAction;
import java.io.File;

public class DeleteFiles extends TestAction {

    @Override
    public void run() {
        super.run();

        String directoryPath = readStringArgument("directory");
        String pattern = readStringArgument("pattern", null);
        String fileName = readStringArgument("filename", null);
        
        
        try {
                File directory = new File(directoryPath);
                int fileCounter =  0;
                if (directory.exists()) {
                    if (fileName != null) {
                        for (File file : directory.listFiles()) {
                            if (file.getName().equals(fileName)) {
                              file.delete();
                              fileCounter ++;
                            }  
                        }
                    } else if (pattern != null) {
                        for (File file : directory.listFiles()) {
                            if (file.getName().contains(pattern)) {
                              file.delete();
                              fileCounter ++;
                            }  
                        }
                    } else {
                        throw new RuntimeException("Neither the \"filename\" argument, nor the \"pattern\" argument were provided.");
                    }
                    System.out.println(String.format("Total deleted files: %s",fileCounter));


                } else {
                    log.warning(String.format("Directory \"%s\" doesn't exist", directoryPath));

                }
        } catch (Exception ex) {
            throw new RuntimeException("Failed to delete file", ex);
        } 
    }    
}
