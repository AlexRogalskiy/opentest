extends layout
block content
    script.
        var sessionId = '#{session.id}';

    div.container( ng-controller="SessionCtrl")
        div.row
            div.col-sm-12
                h4
                    | Test session {{vm.session.id}}&nbsp;&nbsp;
                    span.badge {{vm.session.status}}
        div.row
            div.col-md-12
                ul.nav.nav-tabs(data-tabs="tabs")
                    li.active
                        a(href="#results" data-toggle="tab") Test results
                    li
                        a(href="#log" data-toggle="tab") Log
                    li
                        a(href="#options" data-toggle="tab") Options
                
                p
                div.tab-content
                    div.tab-pane.active(id="results")
                            div.row
                                div.col-md-8
                                    table.table.table-hover
                                            thead
                                                tr
                                                    th Test
                                                    th Duration
                                                    th Result
                                            tbody
                                                tr(ng-repeat="test in vm.session.tests" ng-cloak)
                                                    td
                                                        span.test-name {{test.name}}&#32
                                                        span.faded {{test.path}}
                                                    td {{test.timeCompleted ? vm.Math.round((test.timeCompleted - test.timeStarted)/1000) + ' sec' : 'N/A'}}
                                                    td(ng-class="{red: test.result === 'failed', green: test.result === 'passed'}") {{test.result || 'pending'}}
                                div.col-md-4
                                    div.panel.panel-default
                                        div.panel-heading SUMMARY
                                        table.table.table-hover
                                            tr
                                                td Created
                                                td {{vm.session.timeCreated ? vm.moment(vm.session.timeCreated).format('LLL') : 'N/A'}}
                                            tr
                                                td Started
                                                td {{vm.session.timeStarted ? vm.moment(vm.session.timeStarted).format('LLL') : 'N/A'}}
                                            tr
                                                td Completed
                                                td {{vm.session.timeCompleted ? vm.moment(vm.session.timeCompleted).format('LLL') : 'N/A'}}
                                            tr
                                                td Status
                                                td {{vm.session.status}}
                                            tr
                                                td Result
                                                td {{vm.session.result}}

                    div.tab-pane(id="log")
                        table.table.table-condensed
                                thead
                                    tr
                                        th Timestamp
                                        th Actor
                                        th Message
                                tbody
                                    each logEntry in logEntries
                                        tr
                                            td(style="border: none")= moment(logEntry.time).format('HH:mm:ss')
                                            td(style="border: none")= logEntry.actorType
                                            - if (logEntry.msg.indexOf('ERROR') === 0)
                                                td(style="border: none")
                                                    pre(style="white-space: pre-wrap;")= logEntry.msg
                                            - else
                                                td(style="border: none")= logEntry.msg
                        
                    div.tab-pane(id="options")
                        button.btn.btn-secondary(ng-click="vm.cancelSession(vm.session.id)") Cancel Session
    script.
        // Javascript to enable link to tab
        var url = document.location.toString();
        if (url.match('#')) {
            $('.nav-tabs a[href="#' + url.split('#')[1] + '"]').tab('show');
        } 

        // Change hash in address bar on page-reload or tab select
        $('.nav-tabs a').on('shown.bs.tab', function (e) {
            if(history.pushState) {
                history.pushState(null, null, e.target.hash);
            } else {
                window.location.hash = e.target.hash;
            }
        })
                
block append body_footer
    script(src="/js/ng/SessionCtrl.js")