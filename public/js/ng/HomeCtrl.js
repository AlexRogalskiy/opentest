ngApp.controller('HomeCtrl', ['$scope', '$http', function($scope, $http) {
	$scope.vm = {
		moment: moment,
		runTestSession: runTestSession
	};
	
	init();

	function init() {
		refreshSessions();
		refreshActors();
	}

	function runTestSession() {
		$http.post('/api/session')
		.then(
			function success() {
				refreshSessions();
				refreshActors();
			},
			function error(res) {
				console.log(res.data);
			});
	}

	function refreshActors() {
		$http.get('/api/actors')
		.then(
			function success(res) {
				$scope.vm.actors = res.data;
				if ($scope.vm.actors.length) {
					$scope.vm.actors.forEach(function(actor) {
						actor.lastSeenTimeFmt = moment(actor.lastSeenTime).format('HH:mm:ss');
					});
				}
			},
			function error(err) {
				console.log(err.toString());
			});
	}

	function refreshSessions() {
		$http.get('/api/sessions')
		.then(
			function success(res) {
				$scope.vm.testSessions = res.data;

				// Reverse the array to show the most recent sessions on top
				if ($scope.vm.testSessions && $scope.vm.testSessions.length) {
					$scope.vm.testSessions.reverse();
				}
			},
			function error(err) {
				console.log(err.toString());
			});
	}
}])