const spawn = require('child_process').spawn;
const fs = require('fs');
const path = require('path');
const yargs = require('yargs');

yargs.alias('w', 'workdir');

module.exports = {
    start: start
};

function start(options) {
    options = options || {};

    const workDir = /** @type string */ (options.workDir || yargs.argv.workdir || process.cwd());

    const opentestJarsPath = path.join(__dirname, 'jars', '*').replace(/\\/g, '/');
    const actorJarsPath = path.join(workDir, 'user-jars', '*').replace(/\\/g, '/');
    const classPath = `${opentestJarsPath}${path.delimiter}${actorJarsPath}`;

    options.args = options.args || [];

    let allArgs = ['-cp', classPath, 'org.getopentest.Main', '--workdir', workDir];
    allArgs = allArgs.concat(options.args);

    const newProcess = spawn(
        'java',
        allArgs,
        { stdio: 'inherit' });

    newProcess.on('error', function (err) {
        console.log('ERROR: ' + err.message);
        if (err.code === 'ENOENT') {
            console.log('ERROR: Failed to start Java process. Please ensure that the Java runtime is properly installed.');
        }
    });
}